<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Reference - simple_k8s</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <h1>simple_k8s</h1>
        <p class="tagline">API Reference</p>
    </header>

    <nav>
        <ul>
            <li><a href="index.html">Overview</a></li>
            <li><a href="user-guide.html">User Guide</a></li>
            <li><a href="api-reference.html" class="active">API Reference</a></li>
            <li><a href="architecture.html">Architecture</a></li>
            <li><a href="cookbook.html">Cookbook</a></li>
            <li><a href="https://github.com/simple-eiffel/simple_k8s">GitHub</a></li>
        </ul>
    </nav>

    <main>
        <section>
            <h2>K8S_CLIENT</h2>
            <p>Main facade for all Kubernetes API operations.</p>

            <div class="api-section">
                <h3>make</h3>
                <div class="signature">make</div>
                <p>Create client with automatic configuration detection. Checks for in-cluster environment first, then ~/.kube/config.</p>
            </div>

            <div class="api-section">
                <h3>make_with_config</h3>
                <div class="signature">make_with_config (a_config: K8S_CONFIG)</div>
                <p>Create client with explicit configuration.</p>
                <div class="contracts">
                    <h4>Require</h4>
                    <div class="require">config_not_void: a_config /= Void</div>
                    <h4>Ensure</h4>
                    <div class="ensure">config_set: config = a_config</div>
                </div>
            </div>

            <div class="api-section">
                <h3>list_pods</h3>
                <div class="signature">list_pods (a_namespace: STRING): detachable STRING</div>
                <p>List all pods in namespace. Returns raw JSON response.</p>
                <div class="contracts">
                    <h4>Require</h4>
                    <div class="require">namespace_not_empty: not a_namespace.is_empty</div>
                    <div class="require">configured: is_configured</div>
                </div>
            </div>

            <div class="api-section">
                <h3>scale_deployment</h3>
                <div class="signature">scale_deployment (a_name, a_namespace: STRING; a_replicas: INTEGER): BOOLEAN</div>
                <p>Scale deployment to specified replica count.</p>
                <div class="contracts">
                    <h4>Require</h4>
                    <div class="require">name_not_empty: not a_name.is_empty</div>
                    <div class="require">replicas_non_negative: a_replicas >= 0</div>
                    <div class="require">configured: is_configured</div>
                </div>
            </div>

            <div class="api-section">
                <h3>rollout_restart</h3>
                <div class="signature">rollout_restart (a_name, a_namespace: STRING): BOOLEAN</div>
                <p>Trigger rolling restart of deployment by updating restart annotation.</p>
            </div>
        </section>

        <section>
            <h2>K8S_POD</h2>
            <p>Pod resource representation with status queries.</p>

            <div class="api-section">
                <h3>Attributes</h3>
                <table class="api-table">
                    <tr><th>Attribute</th><th>Type</th><th>Description</th></tr>
                    <tr><td>name</td><td>STRING</td><td>Pod name</td></tr>
                    <tr><td>namespace</td><td>STRING</td><td>Pod namespace</td></tr>
                    <tr><td>phase</td><td>STRING</td><td>Pod phase (Running, Pending, etc.)</td></tr>
                    <tr><td>pod_ip</td><td>detachable STRING</td><td>Assigned IP address</td></tr>
                    <tr><td>node_name</td><td>detachable STRING</td><td>Node running the pod</td></tr>
                </table>
            </div>

            <div class="api-section">
                <h3>Status Queries</h3>
                <table class="api-table">
                    <tr><th>Query</th><th>Description</th></tr>
                    <tr><td>is_running</td><td>Pod phase is "Running"</td></tr>
                    <tr><td>is_pending</td><td>Pod phase is "Pending"</td></tr>
                    <tr><td>is_succeeded</td><td>Pod phase is "Succeeded"</td></tr>
                    <tr><td>is_failed</td><td>Pod phase is "Failed"</td></tr>
                    <tr><td>is_ready</td><td>Running and all containers ready</td></tr>
                </table>
            </div>
        </section>

        <section>
            <h2>K8S_SECRET</h2>
            <p>Secret resource with automatic base64 decoding.</p>

            <div class="api-section">
                <h3>item</h3>
                <div class="signature">item (a_key: STRING): detachable STRING</div>
                <p>Get decoded value for key. Automatically decodes base64 data.</p>
            </div>

            <div class="api-section">
                <h3>Type Queries</h3>
                <table class="api-table">
                    <tr><th>Query</th><th>Description</th></tr>
                    <tr><td>is_opaque</td><td>Type is "Opaque"</td></tr>
                    <tr><td>is_tls</td><td>Type is "kubernetes.io/tls"</td></tr>
                    <tr><td>is_docker_config</td><td>Type is "kubernetes.io/dockerconfigjson"</td></tr>
                    <tr><td>is_service_account_token</td><td>Type is "kubernetes.io/service-account-token"</td></tr>
                </table>
            </div>
        </section>

        <section>
            <h2>K8S_ERROR</h2>
            <p>Error classification and handling.</p>

            <div class="api-section">
                <h3>Error Queries</h3>
                <table class="api-table">
                    <tr><th>Query</th><th>HTTP Status</th><th>Description</th></tr>
                    <tr><td>is_unauthorized</td><td>401</td><td>Authentication required</td></tr>
                    <tr><td>is_forbidden</td><td>403</td><td>Permission denied</td></tr>
                    <tr><td>is_not_found</td><td>404</td><td>Resource not found</td></tr>
                    <tr><td>is_server_error</td><td>5xx</td><td>Server-side error</td></tr>
                </table>
            </div>
        </section>

        <section>
            <h2>KUBECTL_QUICK</h2>
            <p>One-liner convenience API for common kubectl-like operations.</p>

            <div class="api-section">
                <h3>Listing Operations</h3>
                <table class="api-table">
                    <tr><th>Feature</th><th>Description</th></tr>
                    <tr><td>get_pods (a_namespace)</td><td>List pods in namespace</td></tr>
                    <tr><td>get_deployments (a_namespace)</td><td>List deployments in namespace</td></tr>
                    <tr><td>get_services (a_namespace)</td><td>List services in namespace</td></tr>
                    <tr><td>get_configmaps (a_namespace)</td><td>List configmaps in namespace</td></tr>
                    <tr><td>get_secrets (a_namespace)</td><td>List secrets in namespace</td></tr>
                </table>
            </div>

            <div class="api-section">
                <h3>Action Operations</h3>
                <table class="api-table">
                    <tr><th>Feature</th><th>Description</th></tr>
                    <tr><td>scale (a_deployment, a_replicas)</td><td>Scale deployment</td></tr>
                    <tr><td>restart (a_deployment)</td><td>Rolling restart</td></tr>
                    <tr><td>delete_pod (a_name)</td><td>Delete specific pod</td></tr>
                    <tr><td>logs (a_pod)</td><td>Get pod logs</td></tr>
                </table>
            </div>
        </section>

        <section>
            <h2>MANIFEST_BUILDER</h2>
            <p>YAML manifest generation for kubectl apply.</p>

            <div class="api-section">
                <h3>Resource Generators</h3>
                <table class="api-table">
                    <tr><th>Feature</th><th>Description</th></tr>
                    <tr><td>add_namespace (a_name)</td><td>Add namespace resource</td></tr>
                    <tr><td>add_pod (a_name, a_image)</td><td>Add simple pod</td></tr>
                    <tr><td>add_deployment (a_name, a_image, a_replicas)</td><td>Add deployment</td></tr>
                    <tr><td>add_service (a_name, a_port)</td><td>Add ClusterIP service</td></tr>
                    <tr><td>add_service_lb (a_name, a_port)</td><td>Add LoadBalancer service</td></tr>
                    <tr><td>add_service_nodeport (a_name, a_port, a_nodeport)</td><td>Add NodePort service</td></tr>
                    <tr><td>add_configmap (a_name, a_data)</td><td>Add ConfigMap</td></tr>
                    <tr><td>add_secret_opaque (a_name, a_data)</td><td>Add Opaque secret</td></tr>
                </table>
            </div>

            <div class="api-section">
                <h3>Output</h3>
                <table class="api-table">
                    <tr><th>Feature</th><th>Description</th></tr>
                    <tr><td>to_yaml</td><td>Get combined YAML (documents joined with ---)</td></tr>
                    <tr><td>save_to_file (a_path)</td><td>Save manifest to file</td></tr>
                    <tr><td>document_count</td><td>Number of resources</td></tr>
                    <tr><td>clear</td><td>Remove all documents</td></tr>
                </table>
            </div>
        </section>

        <section>
            <h2>K8S_CI_QUICK</h2>
            <p>CI/CD pipeline helper with exit codes for shell scripts.</p>

            <div class="api-section">
                <h3>Exit Codes</h3>
                <table class="api-table">
                    <tr><th>Code</th><th>Constant</th><th>Meaning</th></tr>
                    <tr><td>0</td><td>exit_success</td><td>Operation succeeded</td></tr>
                    <tr><td>1</td><td>exit_failure</td><td>General failure</td></tr>
                    <tr><td>2</td><td>exit_not_found</td><td>Resource not found</td></tr>
                    <tr><td>3</td><td>exit_timeout</td><td>Timeout waiting for condition</td></tr>
                    <tr><td>4</td><td>exit_auth_failure</td><td>Authentication/authorization failure</td></tr>
                    <tr><td>5</td><td>exit_not_ready</td><td>Resource not ready/healthy</td></tr>
                </table>
            </div>

            <div class="api-section">
                <h3>Wait Operations</h3>
                <table class="api-table">
                    <tr><th>Feature</th><th>Description</th></tr>
                    <tr><td>wait_for_deployment_ready (name, ns, timeout)</td><td>Wait for deployment to be ready</td></tr>
                    <tr><td>scale_and_wait (name, ns, replicas, timeout)</td><td>Scale and wait for ready</td></tr>
                    <tr><td>rollout_and_wait (name, ns, timeout)</td><td>Restart and wait for ready</td></tr>
                </table>
            </div>

            <div class="api-section">
                <h3>Health Checks</h3>
                <table class="api-table">
                    <tr><th>Feature</th><th>Description</th></tr>
                    <tr><td>check_pod_running (name, ns)</td><td>Check if pod is running</td></tr>
                    <tr><td>check_namespace_active (name)</td><td>Check if namespace is active</td></tr>
                    <tr><td>resource_exists (type, name, ns)</td><td>Check if resource exists</td></tr>
                    <tr><td>is_cluster_reachable</td><td>Check cluster connectivity</td></tr>
                </table>
            </div>
        </section>
    </main>

    <footer>
        <p>Part of the <a href="https://github.com/simple-eiffel">Simple Eiffel</a> ecosystem</p>
    </footer>
</body>
</html>
