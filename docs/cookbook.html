<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cookbook - simple_k8s</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <h1>simple_k8s</h1>
        <p class="tagline">Cookbook</p>
    </header>

    <nav>
        <ul>
            <li><a href="index.html">Overview</a></li>
            <li><a href="user-guide.html">User Guide</a></li>
            <li><a href="api-reference.html">API Reference</a></li>
            <li><a href="architecture.html">Architecture</a></li>
            <li><a href="cookbook.html" class="active">Cookbook</a></li>
            <li><a href="https://github.com/simple-eiffel/simple_k8s">GitHub</a></li>
        </ul>
    </nav>

    <main>
        <section>
            <h2>Ready-to-Use Recipes</h2>
            <p>Copy-paste solutions for common Kubernetes tasks.</p>
        </section>

        <section>
            <h2>Deploy a Web Application</h2>
<pre><code><span class="keyword">local</span>
    client: <span class="type">K8S_CLIENT</span>
    deploy_spec: <span class="type">DEPLOYMENT_SPEC</span>
    svc_spec: <span class="type">SERVICE_SPEC</span>
<span class="keyword">do</span>
    <span class="keyword">create</span> client.make

    <span class="comment">-- Create deployment</span>
    <span class="keyword">create</span> deploy_spec.make (<span class="string">"web-app"</span>, <span class="string">"production"</span>, <span class="string">"nginx:alpine"</span>)
    deploy_spec.set_replicas (3)
    deploy_spec.add_port (80)
    deploy_spec.add_label (<span class="string">"app"</span>, <span class="string">"web"</span>)

    <span class="keyword">if</span> <span class="keyword">attached</span> client.create_deployment (deploy_spec) <span class="keyword">then</span>
        print (<span class="string">"Deployment created%N"</span>)
    <span class="keyword">end</span>

    <span class="comment">-- Expose with service</span>
    <span class="keyword">create</span> svc_spec.make (<span class="string">"web-service"</span>, <span class="string">"production"</span>)
    svc_spec.add_port (80, 80)
    svc_spec.set_selector (<span class="string">"app"</span>, <span class="string">"web"</span>)
    svc_spec.set_type_load_balancer

    <span class="keyword">if</span> <span class="keyword">attached</span> client.create_service (svc_spec) <span class="keyword">then</span>
        print (<span class="string">"Service created%N"</span>)
    <span class="keyword">end</span>
<span class="keyword">end</span></code></pre>
        </section>

        <section>
            <h2>Scale Based on Time of Day</h2>
<pre><code><span class="keyword">local</span>
    client: <span class="type">K8S_CLIENT</span>
    hour: <span class="type">INTEGER</span>
    replicas: <span class="type">INTEGER</span>
<span class="keyword">do</span>
    <span class="keyword">create</span> client.make
    hour := (create {<span class="type">DATE_TIME</span>}.make_now).hour

    <span class="comment">-- Scale up during business hours</span>
    <span class="keyword">if</span> hour >= 9 <span class="keyword">and</span> hour <= 17 <span class="keyword">then</span>
        replicas := 10
    <span class="keyword">else</span>
        replicas := 2
    <span class="keyword">end</span>

    <span class="keyword">if</span> client.scale_deployment (<span class="string">"api-server"</span>, <span class="string">"production"</span>, replicas) <span class="keyword">then</span>
        print (<span class="string">"Scaled to "</span> + replicas.out + <span class="string">" replicas%N"</span>)
    <span class="keyword">end</span>
<span class="keyword">end</span></code></pre>
        </section>

        <section>
            <h2>Health Check All Pods</h2>
<pre><code><span class="keyword">local</span>
    client: <span class="type">K8S_CLIENT</span>
    pod: <span class="type">K8S_POD</span>
    unhealthy: <span class="type">INTEGER</span>
<span class="keyword">do</span>
    <span class="keyword">create</span> client.make

    <span class="keyword">if</span> <span class="keyword">attached</span> client.list_pods (<span class="string">"production"</span>) <span class="keyword">as</span> json <span class="keyword">then</span>
        <span class="comment">-- Parse each pod from items array</span>
        <span class="comment">-- (simplified - actual code would parse JSON array)</span>

        <span class="keyword">if</span> <span class="keyword">not</span> pod.is_ready <span class="keyword">then</span>
            unhealthy := unhealthy + 1
            print (<span class="string">"Unhealthy: "</span> + pod.name + <span class="string">" ("</span> + pod.phase + <span class="string">")%N"</span>)
        <span class="keyword">end</span>
    <span class="keyword">end</span>

    <span class="keyword">if</span> unhealthy > 0 <span class="keyword">then</span>
        print (<span class="string">"WARNING: "</span> + unhealthy.out + <span class="string">" unhealthy pods%N"</span>)
    <span class="keyword">else</span>
        print (<span class="string">"All pods healthy%N"</span>)
    <span class="keyword">end</span>
<span class="keyword">end</span></code></pre>
        </section>

        <section>
            <h2>Read Database Credentials from Secret</h2>
<pre><code><span class="keyword">local</span>
    client: <span class="type">K8S_CLIENT</span>
    secret: <span class="type">K8S_SECRET</span>
    db_host, db_user, db_pass: <span class="type">STRING</span>
<span class="keyword">do</span>
    <span class="keyword">create</span> client.make

    <span class="keyword">if</span> <span class="keyword">attached</span> client.get_secret (<span class="string">"db-credentials"</span>, <span class="string">"production"</span>) <span class="keyword">as</span> json <span class="keyword">then</span>
        <span class="keyword">create</span> secret.make_from_json (json)

        <span class="keyword">if</span> <span class="keyword">attached</span> secret.item (<span class="string">"host"</span>) <span class="keyword">as</span> h <span class="keyword">then</span>
            db_host := h
        <span class="keyword">end</span>

        <span class="keyword">if</span> <span class="keyword">attached</span> secret.item (<span class="string">"username"</span>) <span class="keyword">as</span> u <span class="keyword">then</span>
            db_user := u
        <span class="keyword">end</span>

        <span class="keyword">if</span> <span class="keyword">attached</span> secret.item (<span class="string">"password"</span>) <span class="keyword">as</span> p <span class="keyword">then</span>
            db_pass := p
        <span class="keyword">end</span>

        <span class="comment">-- Connect to database with credentials...</span>
        print (<span class="string">"Connecting to "</span> + db_host + <span class="string">" as "</span> + db_user + <span class="string">"%N"</span>)
    <span class="keyword">end</span>
<span class="keyword">end</span></code></pre>
        </section>

        <section>
            <h2>Rolling Restart After Config Change</h2>
<pre><code><span class="keyword">local</span>
    client: <span class="type">K8S_CLIENT</span>
<span class="keyword">do</span>
    <span class="keyword">create</span> client.make

    <span class="comment">-- After updating a ConfigMap, restart deployments that use it</span>
    <span class="keyword">if</span> client.rollout_restart (<span class="string">"api-server"</span>, <span class="string">"production"</span>) <span class="keyword">then</span>
        print (<span class="string">"api-server restarting...%N"</span>)
    <span class="keyword">end</span>

    <span class="keyword">if</span> client.rollout_restart (<span class="string">"worker"</span>, <span class="string">"production"</span>) <span class="keyword">then</span>
        print (<span class="string">"worker restarting...%N"</span>)
    <span class="keyword">end</span>
<span class="keyword">end</span></code></pre>
        </section>

        <section>
            <h2>List All Namespaces</h2>
<pre><code><span class="keyword">local</span>
    client: <span class="type">K8S_CLIENT</span>
    ns: <span class="type">K8S_NAMESPACE</span>
<span class="keyword">do</span>
    <span class="keyword">create</span> client.make

    <span class="keyword">if</span> <span class="keyword">attached</span> client.list_namespaces <span class="keyword">as</span> json <span class="keyword">then</span>
        <span class="comment">-- Parse namespace list...</span>

        print (<span class="string">"Namespace: "</span> + ns.name)
        <span class="keyword">if</span> ns.is_terminating <span class="keyword">then</span>
            print (<span class="string">" (TERMINATING)"</span>)
        <span class="keyword">end</span>
        print (<span class="string">"%N"</span>)
    <span class="keyword">end</span>
<span class="keyword">end</span></code></pre>
        </section>
    </main>

    <footer>
        <p>Part of the <a href="https://github.com/simple-eiffel">Simple Eiffel</a> ecosystem</p>
    </footer>
</body>
</html>
